<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>MJD-AI</title>
</head>
<body>
  <div id="overlay">
    <div id="confirmBox">
      <p>Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©ØŸ</p>
      <button onclick="confirmDelete(true)">Ù†Ø¹Ù…</button>
      <button onclick="confirmDelete(false)">Ø¥Ù„ØºØ§Ø¡</button>
    </div>
  </div>

  <button id="menuBtn">â˜°</button>
  <div id="sidebar">
    <button id="newChat">ğŸ—¨ï¸</button>
    <div id="historyList"></div>
  </div>

  <h2>MJD-AI</h2>
  <div id="chatContainer"></div>

  <div id="inputBar">
    <textarea id="userInput" placeholder="Ø§Ø³Ø¦Ù„ MJD-AI Ù…Ø§ ØªØ´Ø§Ø¡"></textarea>
    <button id="sendBtn">â¤</button>
  </div>
  
  <style>
  
  @import url('https://fonts.googleapis.com/css2?family=Cairo&display=swap');
* { box-sizing: border-box; }
body {
  margin: 0; font-family: 'Cairo', sans-serif;
  background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
  color: #e0e0e0; height: 100vh; display: flex; flex-direction: column;
}
h2 {
  text-align: center; margin: 10px 0; font-size: 28px;
  color: #20e2ff; text-shadow: 0 0 10px #20e9ff;
}
#chatContainer {
  flex: 1; overflow-y: auto; padding: 10px 20px 90px;
}
.msg {
  max-width: 100%; width: 90%; margin: 10px;
  padding: 12px 18px; border-radius: 16px;
  word-wrap: break-word; white-space: pre-wrap;
  box-shadow: 0 0 4px #00e5ffaa inset;
  position: relative;
}
.ai {
  background-color: #1e2d3a;
  font-size: 16px;
  align-self: flex-end; text-align: right; color: #00e5ff;
}
.user {
  background-color: #203049;
  align-self: flex-start; text-align: left; color: #ffffff;
}

#inputBar {
  position: fixed; bottom: 0; width: 100%; background-color: #101b26;
  display: flex; justify-content: center; padding: 10px;
  box-shadow: 0 -2px 10px #000a; gap: 10px; z-index: 99;
}
textarea {
  width: 75%; height: 50px; resize: none; border-radius: 15px;
  border: none; padding: 12px; font-size: 16px;
  background: #1c2938; color: #fff;
  box-shadow: 0 0 6px #00e5ff88;
}
textarea:focus { outline: none; background-color: #32475d; }
button {
  width: 50px; height: 50px; border-radius: 50%; border: none;
  font-size: 22px; cursor: pointer;
  background: linear-gradient(90deg, #00bcd4, #006064);
  color: #fff; box-shadow: 0 0 10px #00e5ff88;
}
#menuBtn {
  position: fixed; top: 10px; right: 10px; z-index: 10000;
  font-size: 28px; background: none; box-shadow: none;
  background: linear-gradient(90deg, #00bcd4, #006064);
  width: 40px; height: 40px; display: flex;
  align-items: center; justify-content: center;
  margin-top: 5px;
}
#sidebar {
  position: fixed; top: 0; right: 0;
  width: 280px; height: 100%;
  background: #1a2733; padding: 20px;
  transform: translateX(100%);
  transition: transform 0.3s ease;
  z-index: 999;
  overflow-y: auto;
}
#sidebar.active { transform: translateX(0%); }
.chatItem {
  background: #2c3e50; color: #00e5ff; padding: 10px;
  border-radius: 10px; margin-bottom: 10px; cursor: pointer;
  width
}
.chatItem:hover { background: #34495e; }
#newChat {
  margin-bottom: 15px; background: #00bcd4;
  border-radius: 50%; font-size: 18px;
  padding: 8px; margin-right: 200px;
  position: sticky;
  margin-top: -500px;
  z-index: 1000;
  height: 40px;
  width: 40px;
}
#overlay {
  position: fixed; top: 0; left: 0; width: 100%; height: 100%;
  background: rgba(0,0,0,0.4); display: none; z-index: 9900008;
}
#confirmBox {
  background: #243b55; color: white;
  width: 300px; margin: 200px auto;
  padding: 20px; border-radius: 10px;
  box-shadow: 0 0 10px #00e5ff88; text-align: center;
  z-index: 1000000;
}
#confirmBox button {
  margin: 10px; width: auto; border-radius: 10px;
  padding: 5px 20px; font-size: 16px;
}
  </style>

  <script>
  // Ø¹Ù†Ø§ØµØ± DOM
const chatContainer = document.getElementById("chatContainer");
const userInput = document.getElementById("userInput");
const sendBtn = document.getElementById("sendBtn");
const sidebar = document.getElementById("sidebar");
const menuBtn = document.getElementById("menuBtn");
const historyList = document.getElementById("historyList");
const newChatBtn = document.getElementById("newChat");
const overlay = document.getElementById("overlay");

// Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
let messages = [];
let typing = false;
let deleteIndex = null;
let longPressTimer = null;

// Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
const systemMessage = {
  role: "system",
  content: `Ø£Ù†Øª Ù…Ø³Ø§Ø¹Ø¯ Ø°ÙƒÙŠ ØªÙ…Øª Ø¨Ø±Ù…Ø¬ØªÙ‡ ÙŠØ¯ÙˆÙŠÙ‹Ø§ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³ Ø£Ù…Ø¬Ø¯.`
};

// Ø­ÙØ¸ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© ÙÙŠ localStorage
function saveChat() {
  const history = JSON.parse(localStorage.getItem("mjd-chat-histories") || "{}");
  const title = messages.find(m => m.role === "user")?.content?.slice(0, 20) || "Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†";
  history[title] = messages;
  localStorage.setItem("mjd-chat-histories", JSON.stringify(history));
  updateSidebar();
}

// ØªØ­Ù…ÙŠÙ„ Ù…Ø­Ø§Ø¯Ø«Ø© Ù…Ø¹ÙŠÙ†Ø©
function loadChat(msgs) {
  chatContainer.innerHTML = "";
  messages = msgs || [];
  messages.forEach(({ role, content }) => {
    addMessage(role, content);
  });
  sidebar.classList.remove("active");
}

// Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© Ø¥Ù„Ù‰ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
function addMessage(role, content) {
  const msgDiv = document.createElement("div");
  msgDiv.className = `msg ${role === "user" ? "user" : "ai"}`;
  msgDiv.textContent = content;
  chatContainer.appendChild(msgDiv);
  chatContainer.scrollTop = chatContainer.scrollHeight;
}

// Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
async function sendMessage() {
  const text = userInput.value.trim();
  if (!text || typing) return;
  userInput.value = "";
  addMessage("user", text);
  messages.push({ role: "user", content: text });
  saveChat();

  sendBtn.textContent = "â¹ï¸";
  typing = true;

  try {
    const res = await callLLMAPI(text);
    messages.push({ role: "assistant", content: res });
    await typeText(res);
    saveChat();
  } catch (err) {
    typeText("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„.");
  } finally {
    sendBtn.textContent = "â¤";
    typing = false;
  }
}

// Ø¹Ø±Ø¶ Ø§Ù„Ù†Øµ Ø¨Ø´ÙƒÙ„ Ù…ØªØ¯Ø±Ø¬ (ÙƒØªØ§Ø¨Ø©)
async function typeText(text) {
  let current = "";
  const chunk = document.createElement("div");
  chunk.className = "msg ai";
  chatContainer.appendChild(chunk);
  chatContainer.scrollTop = chatContainer.scrollHeight;

  for (let i = 0; i < text.length; i++) {
    if (!typing) break;
    current += text[i];
    chunk.textContent = current;
    chatContainer.scrollTop = chatContainer.scrollHeight;
    await new Promise(res => setTimeout(res, 20));
  }
  if (!typing) chunk.textContent = text;
}

// Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ ÙˆØ§Ø¬Ù‡Ø© Ø¨Ø±Ù…Ø¬Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ù„Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ
async function callLLMAPI(message) {
  const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "Authorization": "Bearer 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"
    },
    body: JSON.stringify({
      model: "mistralai/devstral-small:free",
      messages: [systemMessage, ...messages, { role: "user", content: message }],
      temperature: 0.7
    })
  });

  const data = await response.json();
  return data.choices[0].message.content.trim();
}

// ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© Ù„Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
function updateSidebar() {
  historyList.innerHTML = "";
  const history = JSON.parse(localStorage.getItem("mjd-chat-histories") || "{}");
  Object.keys(history).forEach((title) => {
    const item = document.createElement("div");
    item.className = "chatItem";
    item.textContent = title;
    
    // Ù…Ø¹Ø§Ù„Ø¬Ø§Øª Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø¶ØºØ· Ø§Ù„Ù…Ø·ÙˆÙ„
    item.addEventListener('touchstart', (e) => {
      longPressTimer = setTimeout(() => {
        deleteIndex = title;
        overlay.style.display = "block";
      }, 1000);
    });
    
    item.addEventListener('touchend', () => {
      clearTimeout(longPressTimer);
    });
    
    item.addEventListener('mousedown', (e) => {
      longPressTimer = setTimeout(() => {
        deleteIndex = title;
        overlay.style.display = "block";
      }, 1000);
    });
    
    item.addEventListener('mouseup', () => {
      clearTimeout(longPressTimer);
    });
    
    item.addEventListener('mouseleave', () => {
      clearTimeout(longPressTimer);
    });
    
    item.onclick = (e) => {
      if (longPressTimer) {
        clearTimeout(longPressTimer);
        longPressTimer = null;
      }
      loadChat(history[title]);
    };
    
    historyList.appendChild(item);
  });
}

// ØªØ£ÙƒÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
function confirmDelete(yes) {
  if (yes && deleteIndex) {
    const history = JSON.parse(localStorage.getItem("mjd-chat-histories") || "{}");
    delete history[deleteIndex];
    localStorage.setItem("mjd-chat-histories", JSON.stringify(history));
    updateSidebar();
  }
  overlay.style.display = "none";
  deleteIndex = null;
}

// Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø£Ø²Ø±Ø§Ø±
sendBtn.onclick = () => {
  if (typing) {
    typing = false;
    sendBtn.textContent = "â¤";
  } else {
    sendMessage();
  }
};

menuBtn.onclick = () => sidebar.classList.toggle("active");

newChatBtn.onclick = () => {
  if (messages.length === 0) return;
  messages = [];
  chatContainer.innerHTML = "";
  saveChat();
  sidebar.classList.remove("active");
};


  // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§
window.addEventListener("click", (e) => {
  if (!sidebar.contains(e.target) && !menuBtn.contains(e.target)) {
    sidebar.classList.remove("active");
  }
});

// ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
updateSidebar();

// Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Enter
userInput.addEventListener("keypress", (e) => {
  if (e.key === "Enter" && !e.shiftKey) {
    e.preventDefault();
    sendMessage();
  }
});

// ØªÙ…ÙƒÙŠÙ† Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¹Ù†Ø¯ ÙÙ‚Ø¯Ø§Ù† Ø§Ù„ØªØ±ÙƒÙŠØ² Ù…Ù† Ø­Ù‚Ù„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
userInput.addEventListener("blur", () => {
  if (userInput.value.trim() !== "") {
    sendMessage();
  }
});

// ØªØ­Ø³ÙŠÙ† ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ù„Ù‡ÙˆØ§ØªÙ Ø§Ù„Ù…Ø­Ù…ÙˆÙ„Ø©
document.addEventListener("touchstart", (e) => {
  if (!sidebar.contains(e.target) && !menuBtn.contains(e.target)) {
    sidebar.classList.remove("active");
  }
});

// Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø­Ø¬Ù… Ø§Ù„Ù†Ø§ÙØ°Ø©
window.addEventListener("resize", () => {
  updateSidebar();
});

// ØªØ¹Ø·ÙŠÙ„ Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø¹Ù†Ø¯ Ø§Ù„ÙƒØªØ§Ø¨Ø© Ù„Ù…Ù†Ø¹ Ø§Ù„ØªØ­Ø±ÙƒØ§Øª ØºÙŠØ± Ø§Ù„Ù…Ù‚ØµÙˆØ¯Ø©
userInput.addEventListener("focus", () => {
  document.body.style.overflow = "hidden";
});

userInput.addEventListener("blur", () => {
  document.body.style.overflow = "auto";
});

// ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡ Ù„Ù„Ù‡ÙˆØ§ØªÙ Ø°Ø§Øª Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…Ø­Ø¯ÙˆØ¯Ø©
let isScrolling;
chatContainer.addEventListener("scroll", () => {
  window.clearTimeout(isScrolling);
  isScrolling = setTimeout(() => {
    // ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªÙ…Ø±ÙŠØ±
  }, 100);
});

// ØªÙ‡ÙŠØ¦Ø© Ø£ÙˆÙ„ÙŠØ© Ù„Ù„Ø±Ø³Ø§Ø¦Ù„ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª ÙØ§Ø±ØºØ©
if (localStorage.getItem("mjd-chat-histories") === null) {
  localStorage.setItem("mjd-chat-histories", JSON.stringify({}));
  messages = [];
  addMessage("assistant", "Ù…Ø±Ø­Ø¨Ø§Ù‹! Ø£Ù†Ø§ MJD-AIØŒ ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ Ø§Ù„ÙŠÙˆÙ…ØŸ");
  saveChat();
}

// ØªØ­Ø³ÙŠÙ† Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø£Ø´Ø®Ø§Øµ Ø°ÙˆÙŠ Ø§Ù„Ø¥Ø¹Ø§Ù‚Ø©
document.addEventListener("keydown", (e) => {
  if (e.key === "Escape") {
    sidebar.classList.remove("active");
    overlay.style.display = "none";
  }
});

// ØªØ­Ø³ÙŠÙ† ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­
userInput.addEventListener("keydown", (e) => {
  if (e.key === "ArrowUp" && userInput.selectionStart === 0) {
    // Ø¹Ø±Ø¶ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
  } else if (e.key === "ArrowDown" && 
             userInput.selectionEnd === userInput.value.length) {
    // Ø¹Ø±Ø¶ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù„Ø§Ø­Ù‚Ø©
  }
});

// ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡ Ù„Ù„Ø´Ø¨ÙƒØ§Øª Ø§Ù„Ø¨Ø·ÙŠØ¦Ø©
const connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
if (connection) {
  if (connection.effectiveType === "slow-2g" || connection.effectiveType === "2g") {
    console.log("Ø§ØªØµØ§Ù„ Ø¨Ø·ÙŠØ¡ - ØªÙ… ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„ØªÙˆÙÙŠØ±");
    // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„Ø´Ø¨ÙƒØ§Øª Ø§Ù„Ø¨Ø·ÙŠØ¦Ø© Ù‡Ù†Ø§
  }
}

// Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨ÙŠØ© Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù„Ø£ÙˆÙ„ Ù…Ø±Ø©
window.addEventListener("load", () => {
  const history = JSON.parse(localStorage.getItem("mjd-chat-histories") || "{}");
  if (Object.keys(history).length === 0) {
    addMessage("assistant", "Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ MJD-AI! ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ Ø§Ù„ÙŠÙˆÙ…ØŸ");
    messages.push({
      role: "assistant",
      content: "Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ MJD-AI! ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ Ø§Ù„ÙŠÙˆÙ…ØŸ"
    });
    saveChat();
  }
});

// ØªØ­Ø³ÙŠÙ† ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ù„Ù…Ø³ Ù„Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„ØªÙŠ ØªØ¯Ø¹Ù… Ø§Ù„Ù„Ù…Ø³
if ('ontouchstart' in window) {
  document.body.classList.add("touch-device");
  chatContainer.style.webkitOverflowScrolling = "touch";
}

// ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡ Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ÙƒØ¨ÙŠØ±Ø©
const mediaQuery = window.matchMedia("(min-width: 1024px)");
if (mediaQuery.matches) {
  sidebar.style.width = "320px";
}

// Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ±Ø§Øª Ø¨ØµØ±ÙŠØ© Ø¥Ø¶Ø§ÙÙŠØ©
sendBtn.addEventListener("mousedown", () => {
  sendBtn.style.transform = "scale(0.9)";
});

sendBtn.addEventListener("mouseup", () => {
  sendBtn.style.transform = "scale(1)";
});

sendBtn.addEventListener("mouseleave", () => {
  sendBtn.style.transform = "scale(1)";
});
  </script>
</body>
    </html>
